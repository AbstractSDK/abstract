name: CircleCI Wasm Builder

on:
  workflow_dispatch:
  #   pull_request:
  #     types: [closed]
  #   branches:
  #     - "releases/**"
  # push:

jobs:
  build:
    runs-on: ubuntu-latest
    # if: github.event.pull_request.merged == true
    steps:
      - name: Tickle CircleCI
        env:
          CIRCLE_BRANCH: "main"
          CCI_TOKEN: ${{ secrets.CCI_TOKEN }}
          GHA_Meta: "build_wasms"
        run: |
          if [ "${{ github.event.pull_request.merged }}" = "true" ]; then
            curl -X POST \
            -H "Circle-Token: ${CCI_TOKEN}" \
            -H 'Content-Type: application/json' \
            -H 'Accept: application/json' \
            -d '{
            "branch": "${CIRCLE_BRANCH}",
            "parameters": {
              "GHA_Meta": "${GHA_Meta}"
            }
          }'\
            https://circleci.com/api/v2/project/gh/AbstractSDK/abstract/pipeline
          fi
